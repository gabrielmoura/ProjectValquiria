function proccessPayment(e,n){let t={card_token:e,hash:PagSeguroDirectPayment.getSenderHash(),installment:document.querySelector("select.select_installments").value,card_name:document.querySelector("input[name=card_name]").value};axios.post(urlProccess,{data:t}).then(function(e){toastr.success(e.data.message,"Sucesso"),window.location.href=`${urlThanks}?order=${e.data.order}`}).catch(function(e){n.disabled=!1,n.innerHTML="Efetuar Pagamento";let t=JSON.parse(err.responseText);document.querySelector("div.msg").innerHTML=showErrorMessages(t.data.message.error.message)})}function getInstallments(e,n){PagSeguroDirectPayment.getInstallments({amount:e,brand:n,maxInstallmentNoInterest:0,success:function(e){let t=drawSelectInstallments(e.installments[n]);document.querySelector("div.installments").innerHTML=t},error:function(e){console.log(e)},complete:function(e){}})}function drawSelectInstallments(e){let n="<label>Opções de Parcelamento:</label>";n+='<select class="form-control select_installments">';for(let t of e)n+=`<option value="${t.quantity}|${t.installmentAmount}">${t.quantity}x de ${t.installmentAmount} - Total fica ${t.totalAmount}</option>`;return n+="</select>"}function showErrorMessages(e){return`\n        <div class="alert alert-danger">${e}</div>\n    `}function errorsMapPagseguroJS(e){switch(e){case"10000":return"Bandeira do cartão inválida!";case"10001":return"Número do Cartão com tamanho inválido!";case"10002":case"30405":return"Data com formato inválido!";case"10003":return"Código de segurança inválido";case"10004":return"Código de segurança é obrigatório!";case"10006":return"Tamanho do código de segurança inválido!";default:return"Houve um erro na validação do seu cartão de crédito!"}}let cardNumber=document.querySelector("input[name=card_number]"),spanBrand=document.querySelector("span.brand");cardNumber.addEventListener("keyup",function(){cardNumber.value.length>=6&&PagSeguroDirectPayment.getBrand({cardBin:cardNumber.value.substr(0,6),success:function(e){let n=`<img src="https://stc.pagseguro.uol.com.br/public/img/payment-methods-flags/68x30/${e.brand.name}.png">`;spanBrand.innerHTML=n,document.querySelector("input[name=card_brand]").value=e.brand.name,getInstallments(amoutTransaction,e.brand.name)},error:function(e){console.log(e)},complete:function(e){}})});let submitButton=document.querySelector("button.processCheckout");submitButton.addEventListener("click",function(e){e.preventDefault(),document.querySelector("div.msg").innerHTML="";let n=e.target;n.disabled=!0,n.innerHTML="Carregando...",PagSeguroDirectPayment.createCardToken({cardNumber:document.querySelector("input[name=card_number]").value,brand:document.querySelector("input[name=card_brand]").value,cvv:document.querySelector("input[name=card_cvv]").value,expirationMonth:document.querySelector("input[name=card_month]").value,expirationYear:document.querySelector("input[name=card_year]").value,success:function(e){proccessPayment(e.card.token,n)},error:function(e){n.disabled=!1,n.innerHTML="Efetuar Pagamento";for(let n in e.errors)document.querySelector("div.msg").innerHTML=showErrorMessages(errorsMapPagseguroJS(n))}})});
